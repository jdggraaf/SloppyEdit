/*
 pogomap 2017-05-18 
*/

"use strict";function excludePokemon(e){$selectExclude.val($selectExclude.val().concat(e)).trigger("change")}function notifyAboutPokemon(e){$selectPokemonNotify.val($selectPokemonNotify.val().concat(e)).trigger("change")}function removePokemonMarker(e){mapData.pokemons[e].marker.rangeCircle&&(mapData.pokemons[e].marker.rangeCircle.setMap(null),delete mapData.pokemons[e].marker.rangeCircle),mapData.pokemons[e].marker.setMap(null),mapData.pokemons[e].hidden=!0}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:centerLat,lng:centerLng},zoom:Store.get("zoomLevel"),fullscreenControl:!0,streetViewControl:!1,mapTypeControl:!1,clickableIcons:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.RIGHT_TOP,mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID,"nolabels_style","dark_style","style_light2","style_pgo","dark_style_nl","style_light2_nl","style_pgo_nl","style_pgo_day","style_pgo_night","style_pgo_dynamic"]}});var e=new google.maps.StyledMapType(noLabelsStyle,{name:"No Labels"});map.mapTypes.set("nolabels_style",e);var t=new google.maps.StyledMapType(darkStyle,{name:"Dark"});map.mapTypes.set("dark_style",t);var n=new google.maps.StyledMapType(light2Style,{name:"Light2"});map.mapTypes.set("style_light2",n);var a=new google.maps.StyledMapType(pGoStyle,{name:"RocketMap"});map.mapTypes.set("style_pgo",a);var o=new google.maps.StyledMapType(darkStyleNoLabels,{name:"Dark (No Labels)"});map.mapTypes.set("dark_style_nl",o);var i=new google.maps.StyledMapType(light2StyleNoLabels,{name:"Light2 (No Labels)"});map.mapTypes.set("style_light2_nl",i);var s=new google.maps.StyledMapType(pGoStyleNoLabels,{name:"RocketMap (No Labels)"});map.mapTypes.set("style_pgo_nl",s);var r=new google.maps.StyledMapType(pGoStyleDay,{name:"RocketMap Day"});map.mapTypes.set("style_pgo_day",r);var l=new google.maps.StyledMapType(pGoStyleNight,{name:"RocketMap Night"});map.mapTypes.set("style_pgo_night",l);var c=(new Date).getHours(),p=c>=6&&c<19?r:l;map.mapTypes.set("style_pgo_dynamic",p),map.addListener("maptypeid_changed",function(e){Store.set("map_style",this.mapTypeId)}),map.setMapTypeId(Store.get("map_style")),map.addListener("idle",updateMap),map.addListener("zoom_changed",function(){!0===storeZoom?Store.set("zoomLevel",this.getZoom()):storeZoom=!0,redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons)}),searchMarker=createSearchMarker(),locationMarker=createLocationMarker(),createMyLocationButton(),initSidebar(),$("#scan-here").on("click",function(){var e=map.getCenter();changeLocation(e.lat(),e.lng()),$("#search-switch").checked||($("#search-switch").prop("checked",!0),searchControl("on"))})}function updateLocationMarker(e){return e in searchMarkerStyles&&(locationMarker.setIcon(searchMarkerStyles[e].icon),Store.set("locationMarkerStyle",e)),locationMarker}function createLocationMarker(){var e=Store.get("followMyLocationPosition"),t="lat"in e?e.lat:centerLat,n="lng"in e?e.lng:centerLng,a=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:{lat:t,lng:n},draggable:!0,icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+2});return a.infoWindow=new google.maps.InfoWindow({content:"<div><b>My Location</b></div>",disableAutoPan:!0}),addListeners(a),google.maps.event.addListener(a,"dragend",function(){var e=a.getPosition();Store.set("followMyLocationPosition",{lat:e.lat(),lng:e.lng()})}),a}function updateSearchMarker(e){return e in searchMarkerStyles&&(searchMarker.setIcon(searchMarkerStyles[e].icon),Store.set("searchMarkerStyle",e)),searchMarker}function createSearchMarker(){var e=new google.maps.Marker({position:{lat:centerLat,lng:centerLng},map:map,animation:google.maps.Animation.DROP,draggable:!Store.get("lockMarker"),icon:null,optimized:!1,zIndex:google.maps.Marker.MAX_ZINDEX+1});e.infoWindow=new google.maps.InfoWindow({content:"<div><b>Search Location</b></div>",disableAutoPan:!0}),addListeners(e);var t=null;return google.maps.event.addListener(e,"dragstart",function(){t=e.getPosition()}),google.maps.event.addListener(e,"dragend",function(){var n=e.getPosition();changeSearchLocation(n.lat(),n.lng()).done(function(){t=null}).fail(function(){t&&e.setPosition(t)})}),e}function searchControl(e){$.post(searchControlURI+"?action="+encodeURIComponent(e)),$("#scan-here").toggleClass("disabled","off"===e)}function updateSearchStatus(){$.getJSON(searchControlURI).then(function(e){$("#search-switch").prop("checked",e.status),$("#scan-here").toggleClass("disabled",!e.status)})}function initSidebar(){$("#gyms-switch").prop("checked",Store.get("showGyms")),$("#gym-sidebar-switch").prop("checked",Store.get("useGymSidebar")),$("#gym-sidebar-wrapper").toggle(Store.get("showGyms")),$("#gyms-filter-wrapper").toggle(Store.get("showGyms")),$("#team-gyms-only-switch").val(Store.get("showTeamGymsOnly")),$("#open-gyms-only-switch").val(Store.get("showOpenGymsOnly")),$("#min-level-gyms-filter-switch").val(Store.get("minGymLevel")),$("#max-level-gyms-filter-switch").val(Store.get("maxGymLevel")),$("#last-update-gyms-switch").val(Store.get("showLastUpdatedGymsOnly")),$("#pokemon-switch").prop("checked",Store.get("showPokemon")),$("#pokestops-switch").prop("checked",Store.get("showPokestops")),$("#lured-pokestops-only-switch").val(Store.get("showLuredPokestopsOnly")),$("#lured-pokestops-only-wrapper").toggle(Store.get("showPokestops")),$("#geoloc-switch").prop("checked",Store.get("geoLocate")),$("#lock-marker-switch").prop("checked",Store.get("lockMarker")),$("#start-at-user-location-switch").prop("checked",Store.get("startAtUserLocation")),$("#follow-my-location-switch").prop("checked",Store.get("followMyLocation")),$("#scan-here-switch").prop("checked",Store.get("scanHere")),$("#scan-here").toggle(Store.get("scanHere")),$("#scanned-switch").prop("checked",Store.get("showScanned")),$("#spawnpoints-switch").prop("checked",Store.get("showSpawnpoints")),$("#ranges-switch").prop("checked",Store.get("showRanges")),$("#sound-switch").prop("checked",Store.get("playSound"));var e=new google.maps.places.Autocomplete(document.getElementById("next-location"));$("#next-location").css("background-color",$("#geoloc-switch").prop("checked")?"#e0e0e0":"#ffffff"),$("#search-switch").length&&(updateSearchStatus(),setInterval(updateSearchStatus,5e3)),e.addListener("place_changed",function(){var t=e.getPlace();if(t.geometry){var n=t.geometry.location;changeLocation(n.lat(),n.lng())}});var t=$("#pokemon-icons");$.each(pokemonSprites,function(e,n){t.append($("<option></option>").attr("value",e).text(n.name))}),t.val(pokemonSprites[Store.get("pokemonIcons")]?Store.get("pokemonIcons"):"highres"),$("#pokemon-icon-size").val(Store.get("iconSizeModifier"))}function pad(e){return e<=99?("0"+e).slice(-2):e}function getTypeSpan(e){return"<span style='padding: 2px 5px; text-transform: uppercase; color: white; margin-right: 2px; border-radius: 4px; font-size: 0.8em; vertical-align: text-bottom; background-color: "+e.color+"'>"+e.type+"</span>"}function openMapDirections(e,t){var n="https://www.google.com/maps/?daddr="+e+","+t;window.open(n,"_blank")}function toggleOtherPokemon(e){0===(onlyPokemon=0===onlyPokemon?e:0)?(lastpokemon=!1,updateMap()):clearStaleMarkers()}function getDateStr(e){var t="Unknown";return e&&(t=moment(e).format("YYYY-MM-DD HH:mm:ss")),t}function scout(e){var t=atob(e),n=$("#scoutInfo"+t),a=$("#pkmIV"+t),o=$("#pkmMoves"+t),i=$("#pkmGender"+t),s=$("#pkmCP"+t),r=$("#pkmProbs"+t);$.ajax({url:"scout",type:"GET",data:{encounter_id:e},dataType:"json",cache:!1,beforeSend:function e(){n.text("Scouting, please wait..."),n.show()},error:function e(){n.text("Error scouting, try again?")},success:function l(c,p,d){if(c.success){if(0===a.length&&($("#pkmLoc"+t).after(buildIVDiv(t,c.iv_attack,c.iv_defense,c.iv_stamina)),a=$("#pkmIV"+t)),0===s.length&&(a.after(buildCPDiv(t,c.cp,c.level)),s=$("#pkmCP"+t)),0===o.length){var m=void 0!==moves[c.move_1]?i8ln(moves[c.move_1].name):"gen/unknown",g=void 0!==moves[c.move_2]?i8ln(moves[c.move_2].name):"gen/unknown";s.after(buildMovesDiv(t,m,g,c.rating_attack,c.rating_defense)),o=$("#pkmMoves"+t)}0===i.length&&(o.after(buildGenderDiv(t,c.weight,c.height,c.gender)),i=$("#pkmGender"+t)),0===r.length&&i.after(buildProbsDiv(t,c.catch_prob_1,c.catch_prob_2,c.catch_prob_3)),n.hide();var u=mapData.pokemons[e];u.individual_attack=c.iv_attack,u.individual_defense=c.iv_defense,u.individual_stamina=c.iv_stamina,u.move_1=c.move_1,u.move_2=c.move_2,u.weight=c.weight,u.height=c.height,u.gender=c.gender,u.cp=c.cp,u.level=c.level,u.catch_prob_1=c.catch_prob_1,u.catch_prob_2=c.catch_prob_2,u.catch_prob_3=c.catch_prob_3,u.rating_attack=c.rating_attack,u.rating_defense=c.rating_defense}else n.text(c.error)}})}function buildIVDiv(e,t,n,a){return'\n        <div id="pkmIV'+e+'">\n            IV: <b>'+getIv(t,n,a).toFixed(1)+"%</b> ("+t+"/"+n+"/"+a+")\n        </div>\n        "}function buildMovesDiv(e,t,n,a,o){return'\n        <div id="pkmMoves'+e+'">\n            Moves: <b>'+t+"</b> / <b>"+n+'</b> | Rating: <b title="Moveset Attack Rating">'+a+'</b> / <b title="Moveset Defense Rating">'+o+"</b>\n        </div>\n        "}function buildGenderDiv(e,t,n,a){return'\n        <div id="pkmGender'+e+'">\n            Gender: '+genderType[a-1]+" | Weight: "+t.toFixed(2)+"kg | Height: "+n.toFixed(2)+"m\n        </div>\n        "}function buildCPDiv(e,t,n){return'\n        <div id="pkmCP'+e+'">\n            Level: <b title="Maximum Level is 30">'+n+"</b> | CP: <b>"+t+"</b>\n        </div>\n        "}function buildProbsDiv(e,t,n,a){return t*=100,n*=100,a*=100,'\n        <div id="pkmProbs'+e+'">\n            Pokeball: '+t.toFixed(1)+"% | Great Ball: "+n.toFixed(1)+"% | Ultra Ball: "+a.toFixed(1)+"%\n        </div>\n        "}function pokemonLabel(e){var t=e.pokemon_name,n=e.pokemon_rarity?"("+e.pokemon_rarity+")":"",a=e.pokemon_types,o="",i=e.encounter_id,s=e.pokemon_id,r=e.latitude,l=e.longitude,c=e.disappear_time,p=new Date(c),d=e.individual_attack,m=e.individual_defense,g=e.individual_stamina,u=void 0!==moves[e.move_1]?i8ln(moves[e.move_1].name):"gen/unknown",k=void 0!==moves[e.move_2]?i8ln(moves[e.move_2].name):"gen/unknown",y=e.weight,h=e.height,v=e.gender,f=e.form,w=e.cp,S=e.level,_=e.catch_prob_1,M=e.catch_prob_2,b=e.catch_prob_3,L=e.rating_attack,P=e.rating_defense,D=atob(i);$.each(a,function(e,t){o+=getTypeSpan(t)});var x="";null!==d&&null!==m&&null!==g&&(x+=buildIVDiv(D,d,m,g)),null!=w&&(x+=buildCPDiv(D,w,S)),"gen/unknown"!==u&&(x+=buildMovesDiv(D,u,k,L,P)),null!=v&&(x+=buildGenderDiv(D,y,h,v)),null!=_&&(x+=buildProbsDiv(D,_,M,b));var T;T=null===w?"<a href='javascript:void(0);' onclick='javascript:scout(\""+i+"\");' title='Scout CP'>Scout</a>&nbsp;&nbsp":"";var I="\n        <div>\n            <b>"+t+"</b>";return 201===s&&null!==f&&f>0&&(I+=" ("+unownForm[e.form]+")"),I+="<span> - </span>\n            <small>\n                <a href='http://www.pokemon.com/us/pokedex/"+s+"' target='_blank' title='View in Pokedex'>#"+s+"</a>\n            </small>\n            <span> "+n+"</span>\n            <span> - </span>\n            <small>"+o+"</small>\n        </div>\n        <div>\n            Disappears at "+pad(p.getHours())+":"+pad(p.getMinutes())+":"+pad(p.getSeconds())+"\n            <span class='label-countdown' disappears-at='"+c+"'>(00m00s)</span>\n        </div>\n        <div id=\"pkmLoc"+D+'">\n            Location: '+r.toFixed(6)+", "+l.toFixed(7)+"\n        </div>\n            "+x+'\n        <div id="scoutInfo'+D+'" style="display:none;"></div>\n        <div>\n            <a href=\'javascript:excludePokemon('+s+")'>Exclude</a>&nbsp;&nbsp\n            <a href='javascript:notifyAboutPokemon("+s+")'>Notify</a>&nbsp;&nbsp\n            <a href='javascript:removePokemonMarker(\""+i+"\")'>Remove</a>&nbsp;&nbsp\n            <a href='javascript:void(0);' onclick='javascript:openMapDirections("+r+","+l+");' title='View in Maps'>Get directions</a>\n        </div>\n        <div>\n            "+T+"\n            <a href='javascript:void(0);' onclick='javascript:toggleOtherPokemon(\""+s+"\");' title='Toggle display of other Pokemon'>Toggle Others</a>\n        </div>"}function gymLabel(e,t,n,a,o){for(var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,r=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],c=arguments[9],p="",d=0;d<l.length;d++)p+='\n            <span class="gym-member" title="'+l[d].pokemon_name+" | "+l[d].trainer_name+" (Lvl "+l[d].trainer_level+')">\n                <i class="pokemon-sprite n'+l[d].pokemon_id+'"></i>\n                <span class="cp team-'+t+'">'+l[d].pokemon_cp+"</span>\n            </span>";var m=getDateStr(i),g=getDateStr(s),u="";Store.get("useGymSidebar")||(u="<div>\n                <a href='javascript:void(0);' onclick='javascript:openMapDirections("+a+","+o+");' title='View in Maps'>Get directions</a>\n            </div>");var k=r?"<div>"+r+"</div>":"",y=["0, 0, 0, .4","74, 138, 202, .6","240, 68, 58, .6","254, 217, 40, .6"],h;if(0===t)h="\n            <div>\n                <center>\n                    <div>\n                        <b style='color:rgba("+y[t]+")'>"+e+"</b><br>\n                        <img height='70px' style='padding: 5px;' src='static/forts/"+e+"_large.png'>\n                    </div>\n                    "+k+"\n                    <div>\n                        Location: "+a.toFixed(6)+", "+o.toFixed(7)+"\n                    </div>\n                    <div>\n                        Last Scanned: "+m+"\n                    </div>\n                    <div>\n                        Last Modified: "+g+"\n                    </div>\n                    "+u+"\n                </center>\n            </div>";else{var v=getGymLevel(n);h="\n            <div>\n                <center>\n                    <div style='padding-bottom: 2px'>\n                        Gym owned by:\n                    </div>\n                    <div>\n                        <b style='color:rgba("+y[t]+")'>Team "+e+"</b><br>\n                        <img height='70px' style='padding: 5px;' src='static/forts/"+e+"_large.png'>\n                    </div>\n                    <div>\n                        "+k+"\n                    </div>\n                    <div>\n                        Level: "+v+" | Prestige: "+n+"/"+(gymPrestige[v-1]||5e4)+"\n                    </div>\n                    <div>\n                        "+p+"\n                    </div>\n                    <div>\n                        Location: "+a.toFixed(6)+", "+o.toFixed(7)+"\n                    </div>\n                    <div>\n                        Last Scanned: "+m+"\n                    </div>\n                    <div>\n                        Last Modified: "+g+"\n                    </div>\n                    "+u+"\n                </center>\n            </div>"}return h}function getGymLevel(e){for(var t=1;e>=gymPrestige[t-1];)t++;return t}function pokestopLabel(e,t,n){var a;if(e){var o=new Date(e);a="\n            <div>\n                <b>Lured Pokéstop</b>\n            </div>\n            <div>\n                Lure expires at "+pad(o.getHours())+":"+pad(o.getMinutes())+":"+pad(o.getSeconds())+"\n                <span class='label-countdown' disappears-at='"+e+"'>(00m00s)</span>\n            </div>\n            <div>\n                Location: "+t.toFixed(6)+", "+n.toFixed(7)+"\n            </div>\n            <div>\n                <a href='javascript:void(0);' onclick='javascript:openMapDirections("+t+","+n+");' title='View in Maps'>Get directions</a>\n            </div>"}else a="\n            <div>\n                <b>Pokéstop</b>\n            </div>\n            <div>\n                Location: "+t.toFixed(6)+", "+n.toFixed(7)+"\n            </div>\n            <div>\n                <a href='javascript:void(0);' onclick='javascript:openMapDirections("+t+","+n+");' title='View in Maps'>Get directions</a>\n            </div>";return a}function formatSpawnTime(e){return("0"+Math.floor((e+3600)%3600/60)).substr(-2)+":"+("0"+e%60).substr(-2)}function spawnpointLabel(e){var t="\n        <div>\n            <b>Spawn Point</b>\n        </div>\n        <div>\n            Every hour from "+formatSpawnTime(e.time)+" to "+formatSpawnTime(e.time+900)+"\n        </div>";return e.special&&(t+="\n            <div>\n                May appear as early as "+formatSpawnTime(e.time-1800)+"\n            </div>"),t}function addRangeCircle(e,t,n,a){var o=null,i=new google.maps.LatLng(e.position.lat(),e.position.lng()),s=["#999999","#0051CF","#FF260E","#FECC23"],r=s[0];a&&(r=s[a]);var l,c;switch(n){case"pokemon":c="#C233F2",l=40;break;case"pokestop":c="#3EB0FF",l=40;break;case"gym":c=r,l=40}t&&(o=t);var p={map:o,radius:l,strokeWeight:1,strokeColor:c,strokeOpacity:.9,center:i,fillColor:c,fillOpacity:.3};return new google.maps.Circle(p)}function isRangeActive(e){return!(e.getZoom()<16)&&Store.get("showRanges")}function getIv(e,t,n){return null!==e&&100*(e+t+n)/45}function lpad(e,t,n){return Array(Math.max(t-String(e).length+1,0)).join(n)+e}function repArray(e,t,n){for(var a=0;a<t.length;a++)e=e.replace(t[a],n[a]);return e}function getTimeUntil(e){var t=+new Date,n=e-t,a=Math.floor(n/1e3%60),o=Math.floor(n/1e3/60%60);return{total:n,hour:Math.floor(n/36e5%24),min:o,sec:a,now:t,ttime:e}}function getNotifyText(e){var t=getIv(e.individual_attack,e.individual_defense,e.individual_stamina),n=["<prc>","<pkm>","<atk>","<def>","<sta>"],a=[t?t.toFixed(1):"",e.pokemon_name,e.individual_attack,e.individual_defense,e.individual_stamina],o=repArray(t?notifyIvTitle:notifyNoIvTitle,n,a),i=new Date(e.disappear_time).toLocaleString([],{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),s=getTimeUntil(e.disappear_time),r=s.hour>0?s.hour+":":"";return r+=lpad(s.min,2,0)+"m"+lpad(s.sec,2,0)+"s",{fav_title:o,fav_text:repArray(notifyText,n=["<dist>","<udist>"],a=[i,r])}}function customizePokemonMarker(e,t,n){if(e.addListener("click",function(){this.setAnimation(null),this.animationDisabled=!0}),!e.rangeCircle&&isRangeActive(map)&&(e.rangeCircle=addRangeCircle(e,map,"pokemon")),e.infoWindow=new google.maps.InfoWindow({content:pokemonLabel(t),disableAutoPan:!0}),(notifiedPokemon.indexOf(t.pokemon_id)>-1||notifiedRarity.indexOf(t.pokemon_rarity)>-1)&&(n||(Store.get("playSound")&&audio.play(),sendNotification(getNotifyText(t).fav_title,getNotifyText(t).fav_text,"static/icons/"+t.pokemon_id+".png",t.latitude,t.longitude)),!0!==e.animationDisabled&&e.setAnimation(google.maps.Animation.BOUNCE)),null!=t.individual_attack){var a=getIv(t.individual_attack,t.individual_defense,t.individual_stamina);notifiedMinPerfection>0&&a>=notifiedMinPerfection&&(n||(Store.get("playSound")&&audio.play(),sendNotification(getNotifyText(t).fav_title,getNotifyText(t).fav_text,"static/icons/"+t.pokemon_id+".png",t.latitude,t.longitude)),!0!==e.animationDisabled&&e.setAnimation(google.maps.Animation.BOUNCE))}addListeners(e)}function setupGymMarker(e){var t=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:map,icon:{url:"static/forts/"+Store.get("gymMarkerStyle")+"/"+gymTypes[e.team_id]+(0!==e.team_id?"_"+getGymLevel(e.gym_points):"")+".png",scaledSize:new google.maps.Size(48,48)}});return!t.rangeCircle&&isRangeActive(map)&&(t.rangeCircle=addRangeCircle(t,map,"gym",e.team_id)),t.infoWindow=new google.maps.InfoWindow({content:gymLabel(gymTypes[e.team_id],e.team_id,e.gym_points,e.latitude,e.longitude,e.last_scanned,e.last_modified,e.name,e.pokemon,e.gym_id),disableAutoPan:!0}),Store.get("useGymSidebar")?(t.addListener("click",function(){var t=document.querySelector("#gym-details");t.getAttribute("data-id")===e.gym_id&&t.classList.contains("visible")?t.classList.remove("visible"):(t.setAttribute("data-id",e.gym_id),showGymDetails(e.gym_id))}),google.maps.event.addListener(t.infoWindow,"closeclick",function(){t.persist=null}),isMobileDevice()||isTouchDevice()||t.addListener("mouseover",function(){t.infoWindow.open(map,t),clearSelection(),updateLabelDiffTime()}),t.addListener("mouseout",function(){t.persist||t.infoWindow.close()})):addListeners(t),t}function updateGymMarker(e,t){return t.setIcon({url:"static/forts/"+Store.get("gymMarkerStyle")+"/"+gymTypes[e.team_id]+(0!==e.team_id?"_"+getGymLevel(e.gym_points):"")+".png",scaledSize:new google.maps.Size(48,48)}),t.infoWindow.setContent(gymLabel(gymTypes[e.team_id],e.team_id,e.gym_points,e.latitude,e.longitude,e.last_scanned,e.last_modified,e.name,e.pokemon,e.gym_id)),t}function updateGymIcons(){$.each(mapData.gyms,function(e,t){mapData.gyms[e].marker.setIcon({url:"static/forts/"+Store.get("gymMarkerStyle")+"/"+gymTypes[mapData.gyms[e].team_id]+(0!==mapData.gyms[e].team_id?"_"+getGymLevel(mapData.gyms[e].gym_points):"")+".png",scaledSize:new google.maps.Size(48,48)})})}function setupPokestopMarker(e){var t=e.lure_expiration?"PstopLured":"Pstop",n=new google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:map,zIndex:2,icon:"static/forts/"+t+".png"});return!n.rangeCircle&&isRangeActive(map)&&(n.rangeCircle=addRangeCircle(n,map,"pokestop")),n.infoWindow=new google.maps.InfoWindow({content:pokestopLabel(e.lure_expiration,e.latitude,e.longitude),disableAutoPan:!0}),addListeners(n),n}function getColorByDate(e){var t=(Date.now()-e)/1e3/60/15;return t>1&&(t=1),["hsl(",(120*(1-t)).toString(10),",100%,50%)"].join("")}function setupScannedMarker(e){var t=new google.maps.LatLng(e.latitude,e.longitude);return new google.maps.Circle({map:map,clickable:!1,center:t,radius:70,fillColor:getColorByDate(e.last_modified),fillOpacity:.1,strokeWeight:1,strokeOpacity:.5})}function getColorBySpawnTime(e){var t=new Date,n=60*t.getMinutes()+t.getSeconds();n<900&&e>2700?n+=3600:n>2700&&e<900&&(e+=3600);var a=n-e,o=275;return a>=0&&a<=900?o=120*(1-a/60/15):a<0&&a>-300&&(o=50*(1- -a/60/5)+200),o=5*Math.round(o/5)}function changeSpawnIcon(e,t){var n="";n=275===e?"./static/icons/hsl-275-light.png":"./static/icons/hsl-"+e+".png";var a=1.6,o=1,i=Math.round(1.6*(t-10));return i<1&&(i=1),{url:n,scaledSize:new google.maps.Size(i,i),anchor:new google.maps.Point(i/2,i/2)}}function spawnPointIndex(e){var t=1,n=0;return e>=0&&e<=120?t=100+100*(n=e/120):e>=200&&e<=250&&(t=100*(n=(e-200)/50)),t}function setupSpawnpointMarker(e){var t=new google.maps.LatLng(e.latitude,e.longitude),n=getColorBySpawnTime(e.time),a=map.getZoom(),o=new google.maps.Marker({map:map,position:t,icon:changeSpawnIcon(n,a),zIndex:spawnPointIndex(n)});return o.infoWindow=new google.maps.InfoWindow({content:spawnpointLabel(e),disableAutoPan:!0,position:t}),addListeners(o),o}function clearSelection(){document.selection?document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges()}function addListeners(e){return e.addListener("click",function(){e.infoWindowIsOpen?(e.persist=null,e.infoWindow.close(),e.infoWindowIsOpen=!1):(e.infoWindow.open(map,e),clearSelection(),updateLabelDiffTime(),e.persist=!0,e.infoWindowIsOpen=!0)}),google.maps.event.addListener(e.infoWindow,"closeclick",function(){e.persist=null}),isMobileDevice()||isTouchDevice()||e.addListener("mouseover",function(){e.infoWindow.open(map,e),clearSelection(),updateLabelDiffTime()}),e.addListener("mouseout",function(){e.persist||e.infoWindow.close()}),e}function isTemporaryHidden(e){return 0!=onlyPokemon&&e!=onlyPokemon}function clearStaleMarkers(){$.each(mapData.pokemons,function(e,t){(mapData.pokemons[e].disappear_time<(new Date).getTime()||excludedPokemon.indexOf(mapData.pokemons[e].pokemon_id)>=0||isTemporaryHidden(mapData.pokemons[e].pokemon_id))&&(mapData.pokemons[e].marker.rangeCircle&&(mapData.pokemons[e].marker.rangeCircle.setMap(null),delete mapData.pokemons[e].marker.rangeCircle),mapData.pokemons[e].marker.setMap(null),delete mapData.pokemons[e])}),$.each(mapData.lurePokemons,function(e,t){(mapData.lurePokemons[e].lure_expiration<(new Date).getTime()||excludedPokemon.indexOf(mapData.lurePokemons[e].pokemon_id)>=0)&&(mapData.lurePokemons[e].marker.setMap(null),delete mapData.lurePokemons[e])}),$.each(mapData.scanned,function(e,t){mapData.scanned[e].last_modified<(new Date).getTime()-9e5&&(mapData.scanned[e].marker.setMap(null),delete mapData.scanned[e])})}function showInBoundsMarkers(e,t){$.each(e,function(n,a){var o=e[n].marker,i=!1;e[n].hidden||("function"==typeof o.getBounds?map.getBounds().intersects(o.getBounds())&&(i=!0):"function"==typeof o.getPosition&&map.getBounds().contains(o.getPosition())&&(i=!0)),i&&-1!==rangeMarkers.indexOf(t)&&(o.rangeCircle?isRangeActive(map)?o.rangeCircle.setMap(map):o.rangeCircle.setMap(null):isRangeActive(map)&&(o.rangeCircle="gym"===t?addRangeCircle(o,map,t,e[n].team_id):addRangeCircle(o,map,t))),i&&!o.getMap()?(o.setMap(map),o.setAnimation&&o.oldAnimation&&o.setAnimation(o.oldAnimation)):!i&&o.getMap()&&(o.getAnimation&&(o.oldAnimation=o.getAnimation()),o.rangeCircle&&o.rangeCircle.setMap(null),o.setMap(null))})}function loadRawData(){var e=Store.get("showPokemon"),t=Store.get("showGyms"),n=Store.get("showPokestops"),a=Store.get("showScanned"),o=Store.get("showSpawnpoints"),i=Boolean(Store.get("showLuredPokestopsOnly")),s=map.getBounds(),r=s.getSouthWest(),l=s.getNorthEast(),c=r.lat(),p=r.lng(),d=l.lat(),m=l.lng();return $.ajax({url:"raw_data",type:"GET",data:{timestamp:timestamp,pokemon:e,lastpokemon:lastpokemon,pokestops:n,lastpokestops:lastpokestops,luredonly:i,gyms:t,lastgyms:lastgyms,scanned:a,lastslocs:lastslocs,spawnpoints:o,lastspawns:lastspawns,swLat:c,swLng:p,neLat:d,neLng:m,oSwLat:oSwLat,oSwLng:oSwLng,oNeLat:oNeLat,oNeLng:oNeLng,reids:String(reincludedPokemon),eids:String(excludedPokemon)},dataType:"json",cache:!1,beforeSend:function e(){if(rawDataIsLoading)return!1;rawDataIsLoading=!0},error:function e(){toastr.error("Please check connectivity or reduce marker settings.","Error getting data"),toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"25000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"}},complete:function e(){rawDataIsLoading=!1}})}function processPokemons(e,t){if(!Store.get("showPokemon"))return!1;!(t.encounter_id in mapData.pokemons)&&excludedPokemon.indexOf(t.pokemon_id)<0&&t.disappear_time>Date.now()&&!isTemporaryHidden(t.pokemon_id)&&(t.marker&&t.marker.setMap(null),t.hidden||(t.marker=setupPokemonMarker(t,map),customizePokemonMarker(t.marker,t),mapData.pokemons[t.encounter_id]=t))}function processPokestops(e,t){if(!Store.get("showPokestops"))return!1;if(Store.get("showLuredPokestopsOnly")&&!t.lure_expiration)return!0;if(mapData.pokestops[t.pokestop_id]){var n=mapData.pokestops[t.pokestop_id];!!t.lure_expiration!=!!n.lure_expiration&&(n.marker&&n.marker.rangeCircle&&n.marker.rangeCircle.setMap(null),n.marker.setMap(null),t.marker=setupPokestopMarker(t),mapData.pokestops[t.pokestop_id]=t)}else t.marker&&t.marker.rangeCircle&&t.marker.rangeCircle.setMap(null),t.marker&&t.marker.setMap(null),t.marker=setupPokestopMarker(t),mapData.pokestops[t.pokestop_id]=t}function updatePokestops(){if(!Store.get("showPokestops"))return!1;var e=[],t=(new Date).getTime();$.each(mapData.pokestops,function(e,n){n.lure_expiration&&n.lure_expiration<t&&(n.lure_expiration=null,n.marker&&n.marker.rangeCircle&&n.marker.rangeCircle.setMap(null),n.marker.setMap(null),n.marker=setupPokestopMarker(n))}),Store.get("showLuredPokestopsOnly")&&($.each(mapData.pokestops,function(t,n){n.lure_expiration||e.push(t)}),$.each(e,function(e,t){mapData.pokestops[t]&&mapData.pokestops[t].marker&&(mapData.pokestops[t].marker.rangeCircle&&mapData.pokestops[t].marker.rangeCircle.setMap(null),mapData.pokestops[t].marker.setMap(null),delete mapData.pokestops[t])}))}function processGyms(e,t){if(!Store.get("showGyms"))return!1;var n=getGymLevel(t.gym_points),a=function e(t){mapData.gyms[t]&&mapData.gyms[t].marker&&(mapData.gyms[t].marker.rangeCircle&&mapData.gyms[t].marker.rangeCircle.setMap(null),mapData.gyms[t].marker.setMap(null),delete mapData.gyms[t])},o=function e(n,a){return n>t.pokemon.length&&0!==t.pokemon.length};if(1===Store.get("showOpenGymsOnly")&&!o(n,t.pokemon.length))return a(t.gym_id),!0;if(Store.get("showOpenGymsOnly")>1){var i=0;switch(Store.get("showOpenGymsOnly")){case 2:i=1e3;break;case 3:i=2500;break;case 4:i=5e3}if(!o(n,t.pokemon.length)&&(gymPrestige[n-1]>i+t.gym_points||10===n))return a(t.gym_id),!0}if(Store.get("showTeamGymsOnly")&&Store.get("showTeamGymsOnly")!==t.team_id)return a(t.gym_id),!0;if(Store.get("showLastUpdatedGymsOnly")){var s=new Date;if(3600*Store.get("showLastUpdatedGymsOnly")*1e3+t.last_scanned<s.getTime())return a(t.gym_id),!0}return n<Store.get("minGymLevel")?(a(t.gym_id),!0):n>Store.get("maxGymLevel")?(a(t.gym_id),!0):(t.gym_id in mapData.gyms?t.marker=updateGymMarker(t,mapData.gyms[t.gym_id].marker):t.marker=setupGymMarker(t),void(mapData.gyms[t.gym_id]=t))}function processScanned(e,t){if(!Store.get("showScanned"))return!1;var n=t.latitude+"|"+t.longitude;n in mapData.scanned?mapData.scanned[n].last_modified=t.last_modified:(t.marker&&t.marker.setMap(null),t.marker=setupScannedMarker(t),mapData.scanned[n]=t)}function updateScanned(){if(!Store.get("showScanned"))return!1;$.each(mapData.scanned,function(e,t){map.getBounds().intersects(t.marker.getBounds())&&t.marker.setOptions({fillColor:getColorByDate(t.last_modified)})})}function processSpawnpoints(e,t){if(!Store.get("showSpawnpoints"))return!1;var n=t.spawnpoint_id;n in mapData.spawnpoints||(t.marker&&t.marker.setMap(null),t.marker=setupSpawnpointMarker(t),mapData.spawnpoints[n]=t)}function updateSpawnPoints(){if(!Store.get("showSpawnpoints"))return!1;var e=map.getZoom();$.each(mapData.spawnpoints,function(t,n){if(map.getBounds().contains(n.marker.getPosition())){var a=getColorBySpawnTime(n.time);n.marker.setIcon(changeSpawnIcon(a,e)),n.marker.setZIndex(spawnPointIndex(a))}})}function updateMap(){loadRawData().done(function(e){$.each(e.pokemons,processPokemons),$.each(e.pokestops,processPokestops),$.each(e.gyms,processGyms),$.each(e.scanned,processScanned),$.each(e.spawnpoints,processSpawnpoints),showInBoundsMarkers(mapData.pokemons,"pokemon"),showInBoundsMarkers(mapData.lurePokemons,"pokemon"),showInBoundsMarkers(mapData.gyms,"gym"),showInBoundsMarkers(mapData.pokestops,"pokestop"),showInBoundsMarkers(mapData.scanned,"scanned"),showInBoundsMarkers(mapData.spawnpoints,"inbound"),clearStaleMarkers(),updateScanned(),updateSpawnPoints(),updatePokestops(),$("#stats").hasClass("visible")&&countMarkers(map),oSwLat=e.oSwLat,oSwLng=e.oSwLng,oNeLat=e.oNeLat,oNeLng=e.oNeLng,lastgyms=e.lastgyms,lastpokestops=e.lastpokestops,lastpokemon=e.lastpokemon,lastslocs=e.lastslocs,lastspawns=e.lastspawns,(reids=e.reids)instanceof Array&&(ad=reids.filter(function(e){return this.indexOf(e)<0},reincludedPokemon)),timestamp=e.timestamp,lastUpdateTime=Date.now()})}function drawScanPath(e){var t=[];$.each(e,function(e,n){t.push({lat:n.latitude,lng:n.longitude})}),scanPath&&scanPath.setMap(null),scanPath=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2,map:map})}function redrawPokemon(e){var t=!0;$.each(e,function(t,n){var a=e[t];if(!a.hidden){a.marker.rangeCircle&&a.marker.rangeCircle.setMap(null);var o=setupPokemonMarker(a,map,this.marker.animationDisabled);customizePokemonMarker(o,a,!0),a.marker.setMap(null),e[t].marker=o}})}function getPointDistance(e,t){return google.maps.geometry.spherical.computeDistanceBetween(e,t)}function sendNotification(e,t,n,a,o){if(!("Notification"in window))return!1;if("granted"!==Notification.permission)Notification.requestPermission();else{var i=new Notification(e,{icon:n,body:t,sound:"sounds/ding.mp3"});i.onclick=function(){window.focus(),i.close(),centerMap(a,o,20)}}}function createMyLocationButton(){var e=document.createElement("div"),t=document.createElement("button");t.style.backgroundColor="#fff",t.style.border="none",t.style.outline="none",t.style.width="28px",t.style.height="28px",t.style.borderRadius="2px",t.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)",t.style.cursor="pointer",t.style.marginRight="10px",t.style.padding="0px",t.title="My Location",e.appendChild(t);var n=document.createElement("div");n.style.margin="5px",n.style.width="18px",n.style.height="18px",n.style.backgroundImage="url(static/mylocation-sprite-1x.png)",n.style.backgroundSize="180px 18px",n.style.backgroundPosition="0px 0px",n.style.backgroundRepeat="no-repeat",n.id="current-location",t.appendChild(n),t.addEventListener("click",function(){centerMapOnLocation()}),e.index=1,map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(e),google.maps.event.addListener(map,"dragend",function(){document.getElementById("current-location").style.backgroundPosition="0px 0px"})}function centerMapOnLocation(){var e=document.getElementById("current-location"),t="0",n=setInterval(function(){t="-18"===t?"0":"-18",e.style.backgroundPosition=t+"px 0"},500);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var a=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);locationMarker.setPosition(a),map.setCenter(a),Store.set("followMyLocationPosition",{lat:t.coords.latitude,lng:t.coords.longitude}),clearInterval(n),e.style.backgroundPosition="-144px 0px"}):(clearInterval(n),e.style.backgroundPosition="0px 0px")}function changeLocation(e,t){var n=new google.maps.LatLng(e,t);changeSearchLocation(e,t).done(function(){map.setCenter(n),searchMarker.setPosition(n)})}function changeSearchLocation(e,t){return $.post("next_loc?lat="+e+"&lon="+t,{})}function centerMap(e,t,n){var a=new google.maps.LatLng(e,t);map.setCenter(a),n&&(storeZoom=!1,map.setZoom(n))}function i8ln(e){return $.isEmptyObject(i8lnDictionary)&&"en"!==language&&languageLookups<languageLookupThreshold&&$.ajax({url:"static/dist/locales/"+language+".min.json",dataType:"json",async:!1,success:function e(t){i8lnDictionary=t},error:function e(t,n,a){console.log("Error loading i8ln dictionary: "+a),languageLookups++}}),e in i8lnDictionary?i8lnDictionary[e]:e}function updateGeoLocation(){navigator.geolocation&&(Store.get("geoLocate")||Store.get("followMyLocation"))&&navigator.geolocation.getCurrentPosition(function(e){var t=e.coords.latitude,n=e.coords.longitude,a=new google.maps.LatLng(t,n);Store.get("geoLocate")&&void 0!==searchMarker&&getPointDistance(searchMarker.getPosition(),a)>40&&$.post("next_loc?lat="+t+"&lon="+n).done(function(){map.panTo(a),searchMarker.setPosition(a)}),Store.get("followMyLocation")&&void 0!==locationMarker&&getPointDistance(locationMarker.getPosition(),a)>=5&&(map.panTo(a),locationMarker.setPosition(a),Store.set("followMyLocationPosition",{lat:t,lng:n}))})}function createUpdateWorker(){try{if(isMobileDevice()&&window.Worker){var e=new Blob(["onmessage = function(e) {\n                var data = e.data\n                if (data.name === 'backgroundUpdate') {\n                    self.setInterval(function () {self.postMessage({name: 'backgroundUpdate'})}, 5000)\n                }\n            }"]),t=window.URL.createObjectURL(e);(updateWorker=new Worker(t)).onmessage=function(e){var t=e.data;document.hidden&&"backgroundUpdate"===t.name&&Date.now()-lastUpdateTime>2500&&(updateMap(),updateGeoLocation())},updateWorker.postMessage({name:"backgroundUpdate"})}}catch(e){console.log("Webworker error: "+e.message)}}function showGymDetails(e){var t=document.querySelector("#gym-details"),n;t.classList.add("visible"),$.ajax({url:"gym_data",type:"GET",data:{id:e},dataType:"json",cache:!1}).done(function(e){var a=getGymLevel(e.gym_points),o=gymPrestige[a-1]||5e4,i=e.gym_points/o*100,s=getDateStr(e.last_scanned),r=getDateStr(e.last_modified),l=e.pokemon.length?a-e.pokemon.length:0,c=l?" - "+l+" Free Slots":"",p="";p=0===e.team_id?"\n                <center>\n                    <b>Uncontested - 1 Free Slot</b>\n                </center>":"<div>\n                <b>Level "+a+c+"</b>\n            </div>";var d="",m="\n            <center>\n                <div>\n                    <b>"+(e.name||"")+'</b>\n                </div>\n                <img height="100px" style="padding: 5px;" src="static/forts/'+gymTypes[e.team_id]+'_large.png">\n                <div class="prestige-bar team-'+e.team_id+'">\n                    <div class="prestige team-'+e.team_id+'" style="width: '+i+'%">\n                    </div>\n                </div>\n                <div>\n                    '+e.gym_points+"/"+o+"\n                </div>\n                "+p+'\n                <div style="font-size: .7em;">\n                    Last Scanned: '+s+'\n                </div>\n                <div style="font-size: .7em;">\n                    Last Modified: '+r+"\n                </div>\n                <div>\n                    <a href='javascript:void(0);' onclick='javascript:openMapDirections("+e.latitude+","+e.longitude+");' title='View in Maps'>Get directions</a>\n                </div>\n            </center>\n        ";e.pokemon.length?($.each(e.pokemon,function(e,t){var n=getIv(t.iv_attack,t.iv_defense,t.iv_stamina),a=Math.round(100/t.move_2_energy);d+='\n                    <tr onclick=toggleGymPokemonDetails(this)>\n                        <td width="30px">\n                            <i class="pokemon-sprite n'+t.pokemon_id+'"></i>\n                        </td>\n                        <td>\n                            <div style="line-height:1em;">'+t.pokemon_name+'</div>\n                            <div class="cp">CP '+t.pokemon_cp+'</div>\n                        </td>\n                        <td width="190" align="center">\n                            <div class="trainer-level">'+t.trainer_level+'</div>\n                            <div style="line-height: 1em;">'+t.trainer_name+'</div>\n                        </td>\n                        <td width="10">\n                            \x3c!--<a href="#" onclick="toggleGymPokemonDetails(this)">--\x3e\n                                <i class="fa fa-angle-double-down"></i>\n                            \x3c!--</a>--\x3e\n                        </td>\n                    </tr>\n                    <tr class="details">\n                        <td colspan="2">\n                            <div class="ivs">\n                                <div class="iv">\n                                    <div class="type">ATK</div>\n                                    <div class="value">\n                                        '+t.iv_attack+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">DEF</div>\n                                    <div class="value">\n                                        '+t.iv_defense+'\n                                    </div>\n                                </div>\n                                <div class="iv">\n                                    <div class="type">STA</div>\n                                    <div class="value">\n                                        '+t.iv_stamina+'\n                                    </div>\n                                </div>\n                                <div class="iv" style="width: 36px;"">\n                                    <div class="type">PERFECT</div>\n                                    <div class="value">\n                                        '+n.toFixed(0)+'<span style="font-size: .6em;">%</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                        <td colspan="2">\n                            <div class="moves">\n                                <div class="move">\n                                    <div class="name">\n                                        '+t.move_1_name+'\n                                        <div class="type '+t.move_1_type.type_en.toLowerCase()+'">'+t.move_1_type.type+'</div>\n                                    </div>\n                                    <div class="damage">\n                                        '+t.move_1_damage+'\n                                    </div>\n                                </div>\n                                <br>\n                                <div class="move">\n                                    <div class="name">\n                                        '+t.move_2_name+'\n                                        <div class="type '+t.move_2_type.type_en.toLowerCase()+'">'+t.move_2_type.type+'</div>\n                                        <div>\n                                            <i class="move-bar-sprite move-bar-sprite-'+a+'"></i>\n                                        </div>\n                                    </div>\n                                    <div class="damage">\n                                        '+t.move_2_damage+"\n                                    </div>\n                                </div>\n                            </div>\n                        </td>\n                    </tr>\n                    "}),d="<table><tbody>"+d+"</tbody></table>"):d=0===e.team_id?"":'\n                <center>\n                    Gym Leader:<br>\n                    <i class="pokemon-large-sprite n'+e.guard_pokemon_id+'"></i><br>\n                    <b>'+e.guard_pokemon_name+'</b>\n\n                    <p style="font-size: .75em; margin: 5px;">\n                        No additional gym information is available for this gym. Make sure you are collecting <a href="https://rocketmap.readthedocs.io/en/develop/extras/gyminfo.html">detailed gym info.</a>\n                        If you have detailed gym info collection running, this gym\'s Pokemon information may be out of date.\n                    </p>\n                </center>\n            ',t.innerHTML=""+m+d,(n=document.createElement("a")).href="#",n.className="close",n.tabIndex=0,t.appendChild(n),n.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.classList.remove("visible")})})}function toggleGymPokemonDetails(e){e.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-up"),e.lastElementChild.firstElementChild.classList.toggle("fa-angle-double-down"),e.nextElementSibling.classList.toggle("visible")}var $selectExclude,$selectPokemonNotify,$selectRarityNotify,$textPerfectionNotify,$selectStyle,$selectIconResolution,$selectIconSize,$selectOpenGymsOnly,$selectTeamGymsOnly,$selectLastUpdateGymsOnly,$selectMinGymLevel,$selectMaxGymLevel,$selectLuredPokestopsOnly,$selectSearchIconMarker,$selectGymMarkerStyle,$selectLocationIconMarker,$switchGymSidebar,language=""===document.documentElement.lang?"en":document.documentElement.lang,idToPokemon={},i8lnDictionary={},languageLookups=0,languageLookupThreshold=3,searchMarkerStyles,timestamp,excludedPokemon=[],notifiedPokemon=[],notifiedRarity=[],notifiedMinPerfection=null,onlyPokemon=0,buffer=[],reincludedPokemon=[],reids=[],map,rawDataIsLoading=!1,locationMarker,rangeMarkers=["pokemon","pokestop","gym"],searchMarker,storeZoom=!0,scanPath,moves,oSwLat,oSwLng,oNeLat,oNeLng,lastpokestops,lastgyms,lastpokemon,lastslocs,lastspawns,selectedStyle="light",updateWorker,lastUpdateTime,gymTypes=["Uncontested","Mystic","Valor","Instinct"],gymPrestige=[2e3,4e3,8e3,12e3,16e3,2e4,3e4,4e4,5e4],audio=new Audio("static/sounds/ding.mp3"),genderType=["♂","♀","⚲"],unownForm=["unset","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","!","?"],notifyIvTitle="<pkm> <prc>% (<atk>/<def>/<sta>)",notifyNoIvTitle="<pkm>",notifyText="disappears at <dist> (<udist>)",searchControlURI="search_control",updateLabelDiffTime=function e(){$(".label-countdown").each(function(e,t){var n=getTimeUntil(parseInt(t.getAttribute("disappears-at"))),a=n.hour,o=n.min,i=n.sec,s="";n.ttime<n.now?s="(expired)":(s="(",a>0&&(s=a+"h"),s+=lpad(o,2,0)+"m",s+=lpad(i,2,0)+"s",s+=")"),$(t).text(s)})};$(function(){if(!Notification)return void console.log("could not load notifications");"granted"!==Notification.permission&&Notification.requestPermission()}),$(function(){$selectStyle=$("#map-style"),$.getJSON("static/dist/data/mapstyle.min.json").done(function(e){var t=[];$.each(e,function(e,n){t.push({id:e,text:i8ln(n)})}),$selectStyle.select2({placeholder:"Select Style",data:t,minimumResultsForSearch:1/0}),$selectStyle.on("change",function(e){selectedStyle=$selectStyle.val(),map.setMapTypeId(selectedStyle),Store.set("map_style",selectedStyle)}),$selectStyle.val(Store.get("map_style")).trigger("change")}),($selectIconResolution=$("#pokemon-icons")).on("change",function(){Store.set("pokemonIcons",this.value),redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons)}),($selectIconSize=$("#pokemon-icon-size")).select2({placeholder:"Select Icon Size",minimumResultsForSearch:1/0}),$selectIconSize.on("change",function(){Store.set("iconSizeModifier",this.value),redrawPokemon(mapData.pokemons),redrawPokemon(mapData.lurePokemons)}),($selectOpenGymsOnly=$("#open-gyms-only-switch")).select2({placeholder:"Only Show Open Gyms",minimumResultsForSearch:1/0}),$selectOpenGymsOnly.on("change",function(){Store.set("showOpenGymsOnly",this.value),lastgyms=!1,updateMap()}),($selectTeamGymsOnly=$("#team-gyms-only-switch")).select2({placeholder:"Only Show Gyms For Team",minimumResultsForSearch:1/0}),$selectTeamGymsOnly.on("change",function(){Store.set("showTeamGymsOnly",this.value),lastgyms=!1,updateMap()}),($selectLastUpdateGymsOnly=$("#last-update-gyms-switch")).select2({placeholder:"Only Show Gyms Last Updated",minimumResultsForSearch:1/0}),$selectLastUpdateGymsOnly.on("change",function(){Store.set("showLastUpdatedGymsOnly",this.value),lastgyms=!1,updateMap()}),($selectMinGymLevel=$("#min-level-gyms-filter-switch")).select2({placeholder:"Minimum Gym Level",minimumResultsForSearch:1/0}),$selectMinGymLevel.on("change",function(){Store.set("minGymLevel",this.value),lastgyms=!1,updateMap()}),($selectMaxGymLevel=$("#max-level-gyms-filter-switch")).select2({placeholder:"Maximum Gym Level",minimumResultsForSearch:1/0}),$selectMaxGymLevel.on("change",function(){Store.set("maxGymLevel",this.value),lastgyms=!1,updateMap()}),($selectLuredPokestopsOnly=$("#lured-pokestops-only-switch")).select2({placeholder:"Only Show Lured Pokestops",minimumResultsForSearch:1/0}),$selectLuredPokestopsOnly.on("change",function(){Store.set("showLuredPokestopsOnly",this.value),lastpokestops=!1,updateMap()}),($switchGymSidebar=$("#gym-sidebar-switch")).on("change",function(){Store.set("useGymSidebar",this.checked),lastgyms=!1,$.each(["gyms"],function(e,t){$.each(mapData[t],function(e,n){mapData[t][e].marker.rangeCircle&&(mapData[t][e].marker.rangeCircle.setMap(null),delete mapData[t][e].marker.rangeCircle),mapData[t][e].marker.setMap(null)}),mapData[t]={}}),updateMap()}),$selectSearchIconMarker=$("#iconmarker-style"),$selectLocationIconMarker=$("#locationmarker-style"),$.getJSON("static/dist/data/searchmarkerstyle.min.json").done(function(e){searchMarkerStyles=e;var t=[];$.each(e,function(e,n){t.push({id:e,text:n.name})}),$selectSearchIconMarker.select2({placeholder:"Select Icon Marker",data:t,minimumResultsForSearch:1/0}),$selectSearchIconMarker.on("change",function(e){var t=$selectSearchIconMarker.val();Store.set("searchMarkerStyle",t),updateSearchMarker(t)}),$selectSearchIconMarker.val(Store.get("searchMarkerStyle")).trigger("change"),updateSearchMarker(Store.get("lockMarker")),$selectLocationIconMarker.select2({placeholder:"Select Location Marker",data:t,minimumResultsForSearch:1/0}),$selectLocationIconMarker.on("change",function(e){Store.set("locationMarkerStyle",this.value),updateLocationMarker(this.value)}),$selectLocationIconMarker.val(Store.get("locationMarkerStyle")).trigger("change")}),($selectGymMarkerStyle=$("#gym-marker-style")).select2({placeholder:"Select Style",minimumResultsForSearch:1/0}),$selectGymMarkerStyle.on("change",function(e){Store.set("gymMarkerStyle",this.value),updateGymIcons()}),$selectGymMarkerStyle.val(Store.get("gymMarkerStyle")).trigger("change")}),$(function(){function e(e){return e.id?$('<span><i class="pokemon-sprite n'+e.element.value.toString()+'"></i> '+e.text+"</span>"):e.text}function t(e,t,n){return function(){Store.set(n,this.checked),this.checked?("showPokemon"===n?lastpokemon=!1:"showGyms"===n?lastgyms=!1:"showPokestops"===n?lastpokestops=!1:"showScanned"===n?lastslocs=!1:"showSpawnpoints"===n&&(lastspawns=!1),updateMap()):($.each(t,function(t,a){$.each(e[a],function(t,o){e[a][t].marker.rangeCircle&&(e[a][t].marker.rangeCircle.setMap(null),delete e[a][t].marker.rangeCircle),"showRanges"!==n&&e[a][t].marker.setMap(null)}),"showRanges"!==n&&(e[a]={})}),"showRanges"===n&&updateMap())}}Store.get("startAtUserLocation")&&centerMapOnLocation(),$.getJSON("static/dist/data/moves.min.json").done(function(e){moves=e}),$selectExclude=$("#exclude-pokemon"),$selectPokemonNotify=$("#notify-pokemon"),$selectRarityNotify=$("#notify-rarity"),$textPerfectionNotify=$("#notify-perfection");var n=493;$.getJSON("static/dist/data/pokemon.min.json").done(function(t){var n=[];$.each(t,function(e,t){if(e>493)return!1;var a=[];n.push({id:e,text:i8ln(t.name)+" - #"+e}),t.name=i8ln(t.name),t.rarity=i8ln(t.rarity),$.each(t.types,function(e,t){a.push({type:i8ln(t.type),color:t.color})}),t.types=a,idToPokemon[e]=t}),$selectExclude.select2({placeholder:i8ln("Select Pokémon"),data:n,templateResult:e}),$selectPokemonNotify.select2({placeholder:i8ln("Select Pokémon"),data:n,templateResult:e}),$selectRarityNotify.select2({placeholder:i8ln("Select Rarity"),data:[i8ln("Common"),i8ln("Uncommon"),i8ln("Rare"),i8ln("Very Rare"),i8ln("Ultra Rare")]}),$selectExclude.on("change",function(e){buffer=excludedPokemon,excludedPokemon=$selectExclude.val().map(Number),buffer=buffer.filter(function(e){return this.indexOf(e)<0},excludedPokemon),reincludedPokemon=reincludedPokemon.concat(buffer),clearStaleMarkers(),Store.set("remember_select_exclude",excludedPokemon)}),$selectPokemonNotify.on("change",function(e){notifiedPokemon=$selectPokemonNotify.val().map(Number),Store.set("remember_select_notify",notifiedPokemon)}),$selectRarityNotify.on("change",function(e){notifiedRarity=$selectRarityNotify.val().map(String),Store.set("remember_select_rarity_notify",notifiedRarity)}),$textPerfectionNotify.on("change",function(e){notifiedMinPerfection=parseInt($textPerfectionNotify.val(),10),(isNaN(notifiedMinPerfection)||notifiedMinPerfection<=0)&&(notifiedMinPerfection=""),notifiedMinPerfection>100&&(notifiedMinPerfection=100),$textPerfectionNotify.val(notifiedMinPerfection),Store.set("remember_text_perfection_notify",notifiedMinPerfection)}),$selectExclude.val(Store.get("remember_select_exclude")).trigger("change"),$selectPokemonNotify.val(Store.get("remember_select_notify")).trigger("change"),$selectRarityNotify.val(Store.get("remember_select_rarity_notify")).trigger("change"),$textPerfectionNotify.val(Store.get("remember_text_perfection_notify")).trigger("change"),isTouchDevice()&&isMobileDevice()&&$(".select2-search input").prop("readonly",!0)}),window.setInterval(updateLabelDiffTime,1e3),window.setInterval(updateMap,5e3),window.setInterval(updateGeoLocation,1e3),createUpdateWorker(),$("#gyms-switch").change(function(){var e={duration:500},n=$("#gym-sidebar-wrapper");this.checked?(lastgyms=!1,n.show(e)):(lastgyms=!1,n.hide(e));var a=$("#gyms-filter-wrapper");this.checked?(lastgyms=!1,a.show(e)):(lastgyms=!1,a.hide(e)),t(mapData,["gyms"],"showGyms").bind(this)()}),$("#pokemon-switch").change(function(){t(mapData,["pokemons"],"showPokemon").bind(this)()}),$("#scanned-switch").change(function(){t(mapData,["scanned"],"showScanned").bind(this)()}),$("#spawnpoints-switch").change(function(){t(mapData,["spawnpoints"],"showSpawnpoints").bind(this)()}),$("#ranges-switch").change(t(mapData,["gyms","pokemons","pokestops"],"showRanges")),$("#pokestops-switch").change(function(){var e={duration:500},n=$("#lured-pokestops-only-wrapper");return this.checked?(lastpokestops=!1,n.show(e)):(lastpokestops=!1,n.hide(e)),t(mapData,["pokestops"],"showPokestops").bind(this)()}),$("#sound-switch").change(function(){Store.set("playSound",this.checked)}),$("#geoloc-switch").change(function(){$("#next-location").prop("disabled",this.checked),$("#next-location").css("background-color",this.checked?"#e0e0e0":"#ffffff"),navigator.geolocation?Store.set("geoLocate",this.checked):this.checked=!1}),$("#lock-marker-switch").change(function(){Store.set("lockMarker",this.checked),searchMarker.setDraggable(!this.checked)}),$("#search-switch").change(function(){searchControl(this.checked?"on":"off")}),$("#start-at-user-location-switch").change(function(){Store.set("startAtUserLocation",this.checked)}),$("#follow-my-location-switch").change(function(){navigator.geolocation?Store.set("followMyLocation",this.checked):this.checked=!1,locationMarker.setDraggable(!this.checked)}),$("#scan-here-switch").change(function(){this.checked&&!Store.get("scanHereAlerted")&&(alert("Use this feature carefully ! This button will set the current map center as new search location. This may cause worker to teleport long range."),Store.set("scanHereAlerted",!0)),$("#scan-here").toggle(this.checked),Store.set("scanHere",this.checked)}),$("#nav-accordion").length&&$("#nav-accordion").accordion({active:0,collapsible:!0,heightStyle:"content"}),$("#pokemonList_table").DataTable({paging:!1,searching:!1,info:!1,errMode:"throw",language:{emptyTable:""},columns:[{orderable:!1},null,null,null]}).order([1,"asc"])});
//# sourceMappingURL=map.min.js.map