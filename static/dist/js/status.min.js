/*
 pogomap 2017-05-18 
*/

"use strict";function getFormattedDate(a){return moment(a).format("YYYY-MM-DD HH:mm:ss")}function addMainWorker(a){var s='\n     <div id="worker_'+a+'" class="worker">\n       <span id="name_'+a+'" class="name"></span>\n       <span id="method_'+a+'" class="method"></span>\n       <span id="message_'+a+'" class="message"></span>\n     </div>\n   ';$(s).appendTo("#status_container"),addTable(a)}function processMainWorker(a,s){var e=hashFnv32a(s.worker_name,!0);0===$("#worker_"+e).length&&addMainWorker(e),$("#name_"+e).html(s.worker_name),$("#method_"+e).html("("+s.method+")"),$("#message_"+e).html(s.message.replace(/\n/g,"<br>"))}function addWorker(a,s){var e='\n     <div id="row_'+s+'" class="status_row">\n       <div id="username_'+s+'" class="status_cell"/>\n       <div id="success_'+s+'"  class="status_cell"/>\n       <div id="fail_'+s+'"     class="status_cell"/>\n       <div id="no_items_'+s+'"  class="status_cell"/>\n       <div id="skip_'+s+'"     class="status_cell"/>\n       <div id="captchas_'+s+'" class="status_cell"/>\n       <div id="lastmod_'+s+'"  class="status_cell"/>\n       <div id="message_'+s+'"  class="status_cell"/>\n     </div>\n   ';$(e).appendTo("#table_"+a)}function addHashtable(a,s){var e='\n    <div id="hashrow_'+s+'" class="status_row">\n      <div id="key_'+s+'" class="status_cell"/>\n      <div id="maximum_'+s+'" class="status_cell"/>\n      <div id="remaining_'+s+'" class="status_cell"/>\n      <div id="usage_'+s+'" class="status_cell"/>\n      <div id="peak_'+s+'" class="status_cell"/>\n      <div id="expires_'+s+'" class="status_cell"/>\n      <div id="last_updated_'+s+'" class="status_cell"/>\n    </div>\n    ';$(e).appendTo("#hashtable_"+a)}function processWorker(a,s){var e=hashFnv32a(s.username,!0),t;if(groupByWorker){if(t=hashFnv32a(s.worker_name,!0),0===$("#table_"+t).length)return}else t="global",0===$("#table_global").length&&addTable("global");0===$("#row_"+e).length&&addWorker(t,e);var n=getFormattedDate(new Date(s.last_modified));$("#username_"+e).html(s.username),$("#success_"+e).html(s.success),$("#fail_"+e).html(s.fail),$("#no_items_"+e).html(s.no_items),$("#skip_"+e).html(s.skip),$("#captchas_"+e).html(s.captcha),$("#lastmod_"+e).html(n),$("#message_"+e).html(s.message)}function processHashKeys(a,s){var e=s.key,t=hashFnv32a(e,!0);if(0===$("#hashtable_global").length&&createHashTable("global"),0===$("#hashrow_"+t).length){addHashtable("global",t);var n={samples:[],nextSampleIndex:0};hashkeys[e]=n}var l=hashkeys[e].nextSampleIndex%60;hashkeys[e].nextSampleIndex+=1,hashkeys[e].samples[l]=s.maximum-s.remaining;for(var r=hashkeys[e].samples.length,i=0,o=0;o<r;o++)i+=hashkeys[e].samples[o];var d=i/Math.max(r,1),c=getFormattedDate(new Date(s.last_updated)),u=getFormattedDate(new Date(s.expires));moment(u).unix()?moment().isSameOrAfter(moment(u))&&(u="Expired"):u="Unknown/Invalid",$("#key_"+t).html(e),$("#maximum_"+t).html(s.maximum),$("#remaining_"+t).html(s.remaining),$("#usage_"+t).html(d.toFixed(2)),$("#peak_"+t).html(s.peak),$("#last_updated_"+t).html(c),$("#expires_"+t).html(u)}function parseResult(a){groupByWorker&&showWorkersTable&&$.each(a.main_workers,processMainWorker),showWorkersTable&&$.each(a.workers,processWorker),showHashTable&&$.each(a.hashkeys,processHashKeys)}function createHashTable(a){var s='\n    <div class="status_table" id="hashtable_'+a+'">\n     <div class="status_row header">\n     <div class="status_cell">\n       Hash Keys\n      </div>\n      <div class="status_cell">\n        Maximum RPM\n      </div>\n      <div class="status_cell">\n        RPM Left\n      </div>\n      <div class="status_cell">\n        Usage\n        </div>\n      <div class="status_cell">\n        Peak\n        </div>\n       <div class="status_cell">\n         Expires At\n       </div>\n       <div class="status_cell">\n         Last Modified\n       </div>\n     </div>\n   </div>';s=$(s),$("#status_container").prepend(s),$(s).find(".status_row.header .status_cell").click(sortHashTable)}function sortHashTable(){var a=$(this).parents(".status_table").first(),s=compareHashTable($(this).index()),e=a.find(".status_row:gt(0)").toArray();e.sort(s),this.asc=!this.asc,this.asc||(e=e.reverse());for(var t=0;t<e.length;t++)a.append(e[t])}function getHashtableValue(a,s){return $(a).children(".status_cell").eq(s).html()}function addTable(a){var s='\n     <div class="status_table" id="table_'+a+'">\n       <div class="status_row header">\n         <div class="status_cell">\n           Username\n         </div>\n         <div class="status_cell">\n           Success\n         </div>\n         <div class="status_cell">\n           Fail\n         </div>\n         <div class="status_cell">\n           No Items\n         </div>\n         <div class="status_cell">\n           Skipped\n         </div>\n         <div class="status_cell">\n           Captchas\n         </div>\n         <div class="status_cell">\n           Last Modified\n         </div>\n         <div class="status_cell">\n           Message\n         </div>\n       </div>\n     </div>';(s=$(s)).appendTo("#status_container"),s.find(".status_row.header .status_cell").click(tableSort)}function tableSort(){var a=$(this).parents(".status_table").first(),s=compare($(this).index()),e=a.find(".status_row:gt(0)").toArray();e.sort(s),this.asc=!this.asc,this.asc||(e=e.reverse());for(var t=0;t<e.length;t++)a.append(e[t])}function getCellValue(a,s){return $(a).children(".status_cell").eq(s).html()}function compare(a){return function(s,e){var t=getCellValue(s,a),n=getCellValue(e,a);return $.isNumeric(t)&&$.isNumeric(n)?t-n:t.localeCompare(n)}}function compareHashTable(a){return function(s,e){var t=getHashtableValue(s,a),n=getHashtableValue(e,a);return $.isNumeric(t)&&$.isNumeric(n)?t-n:t.localeCompare(n)}}function updateStatus(){lastRawUpdateTime=new Date,loadRawData().done(function(a){parseResult(a)}).always(function(){var a=new Date-lastRawUpdateTime,s=Math.max(minUpdateDelay-a,1);window.setTimeout(updateStatus,s)})}function hashFnv32a(a,s,e){var t,n,l=void 0===e?2166136261:e;for(t=0,n=a.length;t<n;t++)l^=a.charCodeAt(t),l+=(l<<1)+(l<<4)+(l<<7)+(l<<8)+(l<<24);return s?("0000000"+(l>>>0).toString(16)).substr(-8):l>>>0}function loadRawData(){return $.ajax({url:"status",type:"post",data:{password:statusPagePassword},dataType:"json",beforeSend:function a(){if(rawDataIsLoading)return!1;rawDataIsLoading=!0},complete:function a(){rawDataIsLoading=!1}})}var rawDataIsLoading=!1,statusPagePassword=!1,groupByWorker=!0,showHashTable=!0,showWorkersTable=!0,hashkeys={},minUpdateDelay=1e3,lastRawUpdateTime=new Date;$(document).ready(function(){$("#password").focus(),$("#password_form").submit(function(a){a.preventDefault(),statusPagePassword=$("#password").val(),loadRawData().done(function(a){"ok"===a.login?($(".status_form").remove(),parseResult(a),window.setTimeout(updateStatus,minUpdateDelay)):($(".status_form").effect("bounce"),$("#password").focus())})}),$("#groupbyworker-switch").change(function(){groupByWorker=this.checked,$("#status_container .status_table").remove(),$("#status_container .worker").remove()}),$("#hashkey-switch").change(function(){showHashTable=this.checked,$("#status_container .status_table").remove(),$("#status_container .worker").remove()}),$("#showworker-switch").change(function(){showWorkersTable=this.checked,$("#status_container .status_table").remove(),$("#status_container .worker").remove()})});
//# sourceMappingURL=status.min.js.map